<!DOCTYPE html>
<html>
<head>
  <title>Calculadora</title>
  <meta charset="utf-8">
  <script type="text/javascript">

//Variables globales  
    var oper;
    var n1;
    var n2;
    var list;

//Limpia el input
    const vaciar = () => {
      document.getElementById("pantalla").value = "";
    }

//Cuadrado
    const cuadrado = () => {
      validar();
      let num = document.getElementById("pantalla");
        num.value = num.value * num.value;
        rellenar_info();
    }

//Módulo
    const mod = () => {
      validar();
      let num = document.getElementById("pantalla");
      if (num.value < 0) {
        num.value = - num.value;
      } else if (num.value >= 0){
        num.value = num.value;
      }
    }

//Factorial
    const fact = () => {
      validar();
      let num = document.getElementById("pantalla");
      var total = 1; 
	      for (i=1; i<=num.value; i++) {
		      total = total * i; 
        }
        num.value = total; 
    }  

    const almacena_datos = () => {
      let num = document.getElementById("pantalla");
    }

//Multiplicación
    const mul = () => {
      validar();
      let num = document.getElementById("pantalla");
      n1 = num.value;
      console.log(n1);
      oper = 1;
    }

//Suma
    const add = () => {
      validar();
      let num = document.getElementById("pantalla");
      n1 = num.value;
      console.log(n1);
      oper = 2;
    }

//Igual
    const eq = () => {
      validar();
      var total;
      let num = document.getElementById("pantalla");
      n2 = num.value;
      console.log(n2);
      if (oper == 1){
        num.value = n1*n2;
        oper = null;
      } else if (oper == 2){
        num.value = parseFloat(n1)+parseFloat(n2);
        oper = null;
      }
    }

    const sumatorio = () => {
      validar();
      let num = document.getElementById("pantalla");
      let list = num.value.split(",");
      let i=0, acc=0;
      while (i<list.length) acc += +list[i++];
      num.value = acc;
    }

//Ordena de menor a mayor el CSV
    const ordenar = () => {
      validar();
      let num = document.getElementById("pantalla");
      let list = Array.from(num.value.split(","),Number);
      list.sort(ordenarAux);
      num.value = list;

    }

    function ordenarAux(a, b) {
      return a > b ? 1 : b > a ? -1 : 0;
    }

//Invierte el orden del CSV
    const revertir = () => {
      validar();
      let num = document.getElementById("pantalla");
      let list = num.value.split(",");
      num.value = list.reverse();
    }

    const quitar = () => {
      validar();
      let num = document.getElementById("pantalla");
      let list = num.value.split(",");
      num.value = list.slice(0, -1);;
    }

//Cambia la información
    const rellenar_info = () => {
      let num = document.getElementById("pantalla");
      let newInfo = document.getElementById("info");
      if (num.value < 100) {
        newInfo.innerHTML = "Info: El resultado es menor que 100";
      } else if (num.value >= 100 && num.value <= 200){
        newInfo.innerHTML = "Info: El resultado está entre 100 y 200";
      } else if (num.value > 200){
        newInfo.innerHTML = "Info: El resultado es superior a 200";
      }
    }

//"Sanitiza" el input
    function validar() {
      console.log("Estoy validando")
      let num = document.getElementById("pantalla");
      let list = num.value.split(",");
      if (list.every(isNaN)){
        console.log("No es válido")
        num.value = "Error";
        end;
      } else{ console.log("Es válido")} 
    }

  </script>
</head>

<!-- Cuerpo de la página -->
<body>
<div class="general">
<h1>CALCULADORA</h1>

  Número:
  <input type="text" id="pantalla" onclick="vaciar()">

<h2 id="info" class="grande" title="Info sobre el número">
  Info sobre el número
</h2>

<h3 id="opunit" title="Operaciones unitarias">
  Operaciones unitarias
</h3>
  <button id="cuadrado" onclick="cuadrado()">x<sup>2</sup></button>
  <button id="modulo" onclick="mod()">|x|</button>
  <button id="factorial" onclick="fact()">x!</button>

<h3 id="opunit" title="Operaciones unitarias">
    Operaciones unitarias
</h3>
  <button id="multiplicacion" onclick="mul()">*</button>
  <button id="suma" onclick="add()">+</button>
  <button id="igual" onclick="eq()">=</button>

<h3 id="opunit" title="Operaciones en formato CSV">
    Operaciones en formato CSV
</h3>
  <button id="sumatorio" onclick="sumatorio()">Σx</button>
  <button id="ordenar" onclick="ordenar()">Ordenar</button>
  <button id="revertir" onclick="revertir()">Revertir</button>
  <button id="quitar" onclick="quitar()">Quitar</button>
</div>

</body>

<!-- CSS -->
<style type="text/css">
  body{
    vertical-align: middle;
    background-color: beige;
  }

  button {
    vertical-align: middle;
    width: auto;
    font-size: 125%;
}

  .general {
    vertical-align: middle;
    width: auto;
    background-color:gainsboro;
    font-family: Arial, Helvetica, sans-serif;
    text-align:center;
    float: left;
    padding: 5px;
    border: 10px solid #666;
  }
  
  </style>
</html>

